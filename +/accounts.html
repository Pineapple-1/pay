<style>
    #tray .pillbox, #tray .pill {
        display: none; /* pills are cloned and appended, hide when its sitting in the tray */
    }
    #pillbox {
        padding: 8px;
        overflow-x: scroll;
    }
    .pill {
        display: inline-block;
        background: #eee;
        padding: 2px;
        height: 28px; /* forget element is 24px */
        border-radius: 12px; /* same roundness as 24px forget orb */
    }
    .pill .reference {
        top: -25%;
        margin-left: 8px;
    }
    .pill .reference, .pill .forget {
        display: inline-block;
    }
    .pill .forget {
        width: 24px;
        height: 24px;
        border: 1px solid #999;
        border-radius: 50%;
        cursor: pointer;
    }
    .pill .forget:hover {
        border: 1px solid red;
    }

    .pill .forget:hover:before,
    .pill .forget:hover:after {
        background: red;
    }

    .pill .forget::before,
    .pill .forget::after {
        content: "";
        background: #999;
        position: absolute;
        top: 50%;
        left: 50%;
        width: 12px;
        height: 2px;
        transform: translate(-50%, -50%) rotate(45deg);
    }
    .pill .forget::after {
        transform: translate(-50%, -50%) rotate(-45deg);
    }
    /* modifying parent stylesheet */
    .remember, .submit {
        background: #eee;
    }
    .send {
        padding: 0;
    }
    .send .submit button, .send .submit input {
        color: initial;
        background: #eee;
    }

</style>
<div id="pillbox">

</div>
<div class="pill">
    <div class="reference"><!-- fill in with account's nickname via jquery --></div>
    <div class="forget" title="forget this account"></div>
</div>
<script>
/*
Methods globalized in remember.html include:
    'details' to get the current contents of the check
    'nickname' to create a bankname-last4 reference to an account
    'overwrite' to write account details to the DOM

On load, we're going to grab the Proprietor blob from localstorage. 
Makes a chioce here to only pass data via encrypted localstrorage,
so having to go through enc/dec with any state modification.

For each key in Proprietor.accounts, create a pill by cloning and filling in details, and binding the interaction...
*/
;(async function(){
    // insert the pillbox even if its not being used... might want to style it differently when its emptyx
    $('#pillbox').insertAfter('.send .remember');
    /* remember.html also runs this conditional onload in order to overwrite the check from the default account */
    if(localStorage.Proprietor && $(".flip").hasClass("flipit") === false){
        var {accounts, current} = await SEA.decrypt(localStorage.Proprietor, 'rest');

        for(var reference in accounts){
            $('#tray .pill')
                .clone()
                .attr('reference', reference)
                .attr('current', reference === current)
                .click(() => app.overwrite(accounts[reference]))
                .appendTo('#pillbox')
                .children('.reference').text(reference)
                .siblings('.forget').click(() => forget(reference));
        }
    }
    /* next we'll attach a blur listener, if remember is checked, and the details have changed from the selected account, 
       memorize the new account and insert a new pill - check for relatedTarget so only overwrite when blurring away from check */
    function forget(reference){
        console.log("forgetting", reference)
        $('#pillbox [reference=" + reference + "]').remove();
        // check if we were the last pillbox, if so, uncheck the remember me box to indicate nothing is remembered
        // does this automatically set Proprietor to empty string? 
        // Proprietor has 3 states: undefined (user has never clicked rememberme) empty string (user has feature disabled) and encrypted blob
        // two possible paths for forget: this is the only pill, or, there is more than one pill
        
        if($('#pillbox').children('.pill').length === 1){
            $('.remember').find('[type="checkbox"]').click(); // click the checkbox which will zero-out localStorage.Proprietor
        }
        // 

    }
    
})();
</script>